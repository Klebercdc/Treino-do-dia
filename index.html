<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>TITAN PRO | Elite Workout</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #0b1220; --card: #161e2e; --blue: #3182ce;
            --green: #48bb78; --orange: #ed8936; --red: #e53e3e;
            --text: #ffffff; --text-dim: #a0aec0;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            background: var(--bg); color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0; padding-bottom: 100px; -webkit-font-smoothing: antialiased;
        }

        /* HEADER */
        header {
            padding: env(safe-area-inset-top) 20px 15px;
            background: rgba(11, 18, 32, 0.8); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .logo { font-size: 1.4rem; font-weight: 900; letter-spacing: -1px; }
        .logo span { color: var(--blue); }
        .sync-badge { font-size: 0.6rem; background: var(--glass); padding: 4px 8px; border-radius: 10px; color: var(--text-dim); }

        /* DASHBOARD BOX */
        .timer-container {
            margin: 15px; padding: 20px;
            background: linear-gradient(145deg, #1a2436, #161e2e);
            border-radius: 20px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #timerDisplay { font-size: 3.5rem; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; margin-bottom: 10px; }
        
        .main-btn {
            width: 100%; padding: 15px; border-radius: 15px; border: none;
            font-weight: 800; text-transform: uppercase; cursor: pointer; transition: 0.2s;
        }
        .btn-green { background: var(--green); color: #052c16; }

        /* NAV & IMPORT */
        .nav-scroller { display: flex; gap: 12px; padding: 0 15px 15px; overflow-x: auto; scrollbar-width: none; }
        .pill {
            flex: none; padding: 10px 25px; border-radius: 25px;
            background: var(--card); color: var(--text-dim);
            font-weight: 700; font-size: 0.8rem; cursor: pointer;
        }
        .pill.active { background: var(--blue); color: #fff; }

        /* CARDS */
        .exercise-card {
            background: var(--card); margin: 0 15px 15px;
            border-radius: 20px; padding: 18px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .ex-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .ex-name { font-size: 1.1rem; font-weight: 800; color: var(--blue); }
        
        .set-row {
            display: grid; grid-template-columns: 30px 1fr 1fr 1fr 40px;
            gap: 8px; align-items: center; margin-bottom: 8px;
        }
        .input-group {
            background: #0b1220; border: 1px solid #2d3748;
            border-radius: 8px; padding: 8px 4px;
        }
        .input-group input {
            background: transparent; border: none; color: #fff;
            width: 100%; text-align: center; font-size: 1rem; font-weight: 700;
        }

        /* DOCK */
        .dock {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(11, 18, 32, 0.95); backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255,255,255,0.05);
            display: grid; grid-template-columns: repeat(4, 1fr);
            padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
        }
        .dock-item {
            background: none; border: none; color: var(--text-dim);
            display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 0.6rem;
        }
        .dock-item.active { color: var(--blue); }

        /* MODALS */
        dialog { background: var(--card); color: white; border: 1px solid #2d3748; border-radius: 20px; width: 90%; max-width: 450px; padding: 20px; }
        dialog::backdrop { background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
        textarea { width: 100%; background: #0b1220; border: 1px solid #2d3748; color: white; padding: 10px; border-radius: 10px; font-family: monospace; resize: none; }
    </style>
</head>
<body>

<header>
    <div class="logo">TITAN <span>PRO</span></div>
    <div class="sync-badge" id="syncStatus">SESS√ÉO ATIVA</div>
</header>

<div id="workoutView">
    <div class="timer-container">
        <div id="timerDisplay">02:00</div>
        <button id="timerBtn" class="main-btn btn-green" onclick="toggleTimer()">Iniciar Descanso</button>
    </div>

    <div class="nav-scroller" id="navPills"></div>
    <main id="workoutArea"></main>
    
    <div style="padding: 0 15px 30px; display: flex; gap: 10px;">
        <button class="main-btn" style="background: var(--glass); color: var(--blue); flex: 1;" onclick="addExercise()">+ ADD</button>
        <button class="main-btn" style="background: var(--glass); color: var(--orange); flex: 1;" onclick="openImport()">IMPORTAR</button>
    </div>
</div>

<div id="historyView" style="display:none; padding: 20px;">
    <h2>Hist√≥rico</h2>
    <canvas id="evolutionChart"></canvas>
    <div id="historyList"></div>
</div>

<div class="dock">
    <button class="dock-item active" onclick="switchView('workout')"><i class="fa-solid fa-dumbbell"></i>Treino</button>
    <button class="dock-item" onclick="switchView('history')"><i class="fa-solid fa-chart-line"></i>Evolu√ß√£o</button>
    <button class="dock-item" onclick="finishWorkout()" style="background: var(--green); border-radius: 10px; color: #052c16; margin: 0 5px;"><i class="fa-solid fa-check"></i>SALVAR</button>
    <button class="dock-item" onclick="openConfig()"><i class="fa-solid fa-gear"></i>Config</button>
</div>

<dialog id="modalImport">
    <h3>Importar Treino</h3>
    <p style="font-size: 0.7rem; color: var(--text-dim);">Cole seu CSV ou use o leitor de PDF.</p>
    <textarea id="csvInput" rows="5" placeholder="TREINO,EXERCICIO,SERIES,REPS&#10;A,Supino,4,10"></textarea>
    <div style="margin-top: 15px; display: flex; gap: 10px;">
        <label class="main-btn" style="background: var(--blue); text-align: center; font-size: 0.7rem; flex: 1;">
            üìÑ LER PDF <input type="file" id="pdfFile" accept=".pdf" style="display:none" onchange="handlePDF(this)">
        </label>
        <button class="main-btn btn-green" style="flex: 1;" onclick="processCSV()">IMPORTAR</button>
    </div>
    <button class="main-btn" style="margin-top:10px; background:none; color:var(--red);" onclick="this.closest('dialog').close()">CANCELAR</button>
</dialog>

<dialog id="modalConfig">
    <h3>Configura√ß√µes Profissionais</h3>
    <div style="margin-bottom: 20px;">
        <label style="font-size: 0.8rem; color: var(--text-dim);">TREINOS PR√â-DEFINIDOS</label>
        <button class="main-btn" style="background: var(--glass); margin-top: 5px;" onclick="loadPreset('ABC')">CARREGAR ABC (Hipertrofia)</button>
        <button class="main-btn" style="background: var(--glass); margin-top: 5px;" onclick="loadPreset('FORCA')">CARREGAR UPPER/LOWER (For√ßa)</button>
    </div>
    <button class="main-btn" style="background: var(--red);" onclick="clearAllData()">APAGAR TODOS OS DADOS</button>
    <button class="main-btn" style="margin-top:10px; background:none;" onclick="this.closest('dialog').close()">FECHAR</button>
</dialog>

<script>
    // --- DATABASE & PRESETS ---
    const PRESETS = {
        'ABC': [
            { n: 'TREINO A', e: [{n:'Supino Inclinado', s:4}, {n:'Supino Reto', s:4}, {n:'Desenvolvimento', s:3}, {n:'Tr√≠ceps Corda', s:4}] },
            { n: 'TREINO B', e: [{n:'Puxada Alta', s:4}, {n:'Remada Curvada', s:4}, {n:'Serrote', s:3}, {n:'Rosca Direta', s:4}] },
            { n: 'TREINO C', e: [{n:'Agachamento', s:4}, {n:'Leg Press', s:4}, {n:'Extensora', s:3}, {n:'Flexora', s:3}] }
        ],
        'FORCA': [
            { n: 'SUPERIOR', e: [{n:'Supino Reto', s:5}, {n:'Remada Pendlay', s:5}, {n:'Militar', s:3}] },
            { n: 'INFERIOR', e: [{n:'Agachamento', s:5}, {n:'Terra', s:3}, {n:'Panturrilha', s:5}] }
        ]
    };

    let state = {
        activeTab: 0,
        timer: { time: 120, base: 120, running: false, id: null },
        treinos: []
    };

    // --- RENDER ENGINE ---
    function renderApp() {
        const nav = document.getElementById("navPills");
        const area = document.getElementById("workoutArea");
        
        nav.innerHTML = state.treinos.map((t, i) => `
            <div class="pill ${state.activeTab === i ? 'active' : ''}" onclick="switchTab(${i})">${t.n}</div>
        `).join("");

        const current = state.treinos[state.activeTab];
        area.innerHTML = current ? current.e.map(ex => createCard(ex)).join("") : "";
    }

    function createCard(ex) {
        let rows = "";
        for(let i=0; i < (ex.s || 4); i++) {
            rows += `
                <div class="set-row">
                    <span style="font-size:0.7rem; color:var(--text-dim); text-align:center;">${i+1}</span>
                    <div class="input-group"><input type="number" placeholder="kg" oninput="saveCurrentState()"></div>
                    <div class="input-group"><input type="number" placeholder="reps" oninput="saveCurrentState()"></div>
                    <div class="input-group"><input type="number" placeholder="rpe"></div>
                    <button style="background:none; border:none; color:var(--text-dim);" onclick="toggleDone(this)">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>
                </div>
            `;
        }
        return `
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-name">${ex.n}</div>
                    <i class="fa-solid fa-trash" style="color:var(--red); font-size:0.8rem;" onclick="removeEx('${ex.n}')"></i>
                </div>
                ${rows}
            </div>
        `;
    }

    // --- LOGIC ---
    function switchTab(i) { state.activeTab = i; renderApp(); }

    function loadPreset(key) {
        state.treinos = PRESETS[key];
        state.activeTab = 0;
        renderApp();
        saveCurrentState();
        document.getElementById("modalConfig").close();
    }

    function toggleDone(btn) {
        btn.classList.toggle("active");
        btn.style.color = btn.classList.contains("active") ? "var(--green)" : "var(--text-dim)";
        if(btn.classList.contains("active")) startTimer();
    }

    // --- CSV & PDF IMPORT ---
    function openImport() { document.getElementById("modalImport").showModal(); }

    function processCSV() {
        const csv = document.getElementById("csvInput").value;
        const lines = csv.split('\n').filter(l => l.trim() !== '');
        const grouped = {};
        
        lines.forEach((line, i) => {
            if(i === 0 && line.toUpperCase().includes("TREINO")) return;
            const [treino, ex, sets] = line.split(',');
            if(!grouped[treino]) grouped[treino] = [];
            grouped[treino].push({ n: ex.trim(), s: parseInt(sets) || 4 });
        });

        state.treinos = Object.keys(grouped).map(key => ({ n: key, e: grouped[key] }));
        renderApp();
        document.getElementById("modalImport").close();
        saveCurrentState();
    }

    async function handlePDF(input) {
        const file = input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = async function() {
            const typedarray = new Uint8Array(this.result);
            const pdf = await pdfjsLib.getDocument(typedarray).promise;
            let text = "";
            for(let i=1; i<=pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(" ");
            }
            // Simplifica√ß√£o para o usu√°rio: joga o texto no CSV area para ele ajustar
            document.getElementById("csvInput").value = "Edite o texto extra√≠do para o formato CSV:\n" + text;
        };
        reader.readAsArrayBuffer(file);
    }

    // --- TIMER ---
    function startTimer() {
        clearInterval(state.timer.id);
        state.timer.time = state.timer.base;
        state.timer.running = true;
        state.timer.id = setInterval(() => {
            if(state.timer.time > 0) {
                state.timer.time--;
                updateTimerUI();
            } else {
                clearInterval(state.timer.id);
                state.timer.running = false;
                navigator.vibrate?.(200);
                document.getElementById("timerBtn").textContent = "INICIAR DESCANSO";
            }
        }, 1000);
        document.getElementById("timerBtn").textContent = "PAUSAR";
    }

    function toggleTimer() {
        if(state.timer.running) {
            clearInterval(state.timer.id);
            state.timer.running = false;
            document.getElementById("timerBtn").textContent = "CONTINUAR";
        } else {
            startTimer();
        }
    }

    function updateTimerUI() {
        const m = Math.floor(state.timer.time / 60);
        const s = state.timer.time % 60;
        document.getElementById("timerDisplay").textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    // --- DATA PERSISTENCE ---
    function saveCurrentState() {
        localStorage.setItem("titan_state", JSON.stringify(state));
    }

    function finishWorkout() {
        const history = JSON.parse(localStorage.getItem("titan_history") || "[]");
        history.push({ date: new Date().toISOString(), treinos: state.treinos });
        localStorage.setItem("titan_history", JSON.stringify(history));
        alert("Treino salvo com sucesso!");
    }

    function switchView(view) {
        document.getElementById("workoutView").style.display = view === 'workout' ? 'block' : 'none';
        document.getElementById("historyView").style.display = view === 'history' ? 'block' : 'none';
        if(view === 'history') renderHistory();
    }

    function openConfig() { document.getElementById("modalConfig").showModal(); }

    function clearAllData() {
        if(confirm("Isso apagar√° TODO o hist√≥rico e treinos. Tem certeza?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // Init
    const saved = localStorage.getItem("titan_state");
    if(saved) {
        state = JSON.parse(saved);
        renderApp();
    } else {
        loadPreset('ABC');
    }
</script>
</body>
</html>
