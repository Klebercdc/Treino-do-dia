<!doctype html>
<html lang="pt-PT">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="theme-color" content="#0b1220" />
    <title>TITAN PRO - Smart Log</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";</script>
    <style>
      :root { --bg: #0b1220; --card: #161e2e; --blue: #3182ce; --text: #f7fafc; --orange: #f6ad55; --green: #38b2ac; --red: #e53e3e; }
      body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding-bottom: 20px; }
      .top-header { padding: 15px; background: var(--card); border-bottom: 1px solid #2d3748; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
      .date-badge { font-size: 0.8rem; color: var(--orange); font-weight: bold; background: #0b1220; padding: 4px 10px; border-radius: 15px; }
      .setup-panel { background: var(--card); padding: 20px; border-bottom: 3px solid var(--blue); display: block; }
      .field { margin-bottom: 15px; }
      .field label { font-size: 0.7rem; color: #a0aec0; display: block; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
      .field input { width: 100%; padding: 12px; background: #0b1220; color: #fff; border: 1px solid var(--blue); border-radius: 8px; box-sizing: border-box; }
      .nav-pills { display: flex; gap: 8px; padding: 10px; background: var(--bg); overflow-x: auto; border-bottom: 1px solid #2d3748; }
      .pill { flex: none; padding: 12px 20px; border-radius: 8px; background: #1a202c; font-weight: bold; font-size: 0.75rem; border: 1px solid #2d3748; cursor: pointer; color: #a0aec0; }
      .pill.active { background: var(--blue); color: #fff; }
      .section { display: none; }
      .section.active { display: block; }
      .exercise-card { background: var(--card); border-radius: 12px; padding: 15px; margin: 10px; border: 1px solid #2d3748; }
      .series-grid { display: grid; grid-template-columns: 40px 1fr 1fr 1fr; gap: 8px; align-items: center; margin-bottom: 8px; }
      .input-box { background: #0b1220; border: 1px solid #2d3748; border-radius: 6px; }
      .input-box input { background: transparent; border: none; color: #fff; width: 100%; text-align: center; font-size: 1.1rem; padding: 8px 0; outline: none; }
      .footer-actions { padding: 20px 10px; display: flex; gap: 8px; flex-wrap: wrap; }
      .btn { padding: 15px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; flex: 1; text-align: center; font-size: 0.75rem; text-transform: uppercase; }
      .btn-save { background: var(--green); color: #fff; }
      .btn-config { background: #2d3748; color: var(--blue); border: 1px solid var(--blue); }
      .btn-ia { background: #1a202c; color: var(--orange); border: 1px solid var(--orange); }
      dialog { background: #161e2e; color: #fff; border: 1px solid var(--blue); border-radius: 12px; width: 90%; padding: 20px; }
    </style>
  </head>
  <body>
    <div class="top-header">
      <h1 style="margin: 0; font-size: 1.1rem; color: var(--blue)">TITAN <span style="color: #fff">PRO</span></h1>
      <div class="date-badge" id="displayDate">--/--/--</div>
    </div>

    <div class="setup-panel" id="setupPanel">
      <div class="field">
        <label>NVIDIA API KEY (nvapi-...)</label>
        <input type="password" id="apiKeyInput" placeholder="Cole sua chave aqui" oninput="saveApiKey()">
      </div>
      <button class="btn btn-save" onclick="document.getElementById('setupPanel').style.display='none'">ABRIR TREINO</button>
    </div>

    <div class="nav-pills" id="nav"></div>
    <main id="container"></main>

    <div class="footer-actions">
      <button class="btn btn-config" onclick="document.getElementById('setupPanel').style.display='block'">‚öôÔ∏è CONFIG</button>
      <button class="btn btn-ia" id="btnIA" onclick="enviarParaIA()">ü§ñ IA ANALYST</button>
      <button class="btn btn-save" onclick="location.reload()">NOVO TREINO</button>
    </div>

    <script>
      const KEY_STORAGE = "titanpro_nvidia_key";

      function saveApiKey() {
        const val = document.getElementById('apiKeyInput').value.trim();
        localStorage.setItem(KEY_STORAGE, val);
      }

      function criarCard(nome, sectionId) {
        const id = "ex-" + Math.random().toString(36).slice(2, 9);
        const sec = document.getElementById(sectionId);
        const card = document.createElement("div");
        card.className = "exercise-card";
        card.innerHTML = `
          <strong style="color:var(--blue)">${nome}</strong>
          <div class="series-grid" style="margin-top:10px; color:#718096; font-size:0.6rem"><span>SET</span><span>KG</span><span>REPS</span><span>RPE</span></div>
          ${[1,2,3,4].map(s => `
            <div class="series-grid">
              <span style="font-size:0.7rem">S${s}</span>
              <div class="input-box"><input type="number" class="kg" placeholder="0"></div>
              <div class="input-box"><input type="number" class="reps" placeholder="0"></div>
              <div class="input-box"><input type="number" class="rpe" placeholder="10"></div>
            </div>`).join('')}`;
        sec.appendChild(card);
      }

      async function enviarParaIA() {
        const key = localStorage.getItem(KEY_STORAGE);
        if(!key) return alert("‚ö†Ô∏è Erro: Cole a chave nvapi- em CONFIG.");

        const btn = document.getElementById('btnIA');
        btn.innerText = "‚è≥ PROCESSANDO...";
        btn.disabled = true;

        const treinoData = [...document.querySelectorAll(".exercise-card")].map(c => ({
          ex: c.querySelector("strong").innerText,
          sets: [...c.querySelectorAll(".series-grid:not([style])")].map(r => ({
            kg: r.querySelector(".kg").value,
            reps: r.querySelector(".reps").value,
            rpe: r.querySelector(".rpe").value
          }))
        }));

        try {
          const res = await fetch("https://integrate.api.nvidia.com/v1/chat/completions", {
            method: "POST",
            headers: { 
              "Authorization": `Bearer ${key}`, 
              "Content-Type": "application/json" 
            },
            body: JSON.stringify({
              model: "meta/llama-3.1-405b-instruct",
              messages: [{ role: "user", content: `Analise este treino e sugira progress√£o: ${JSON.stringify(treinoData)}` }],
              temperature: 0.2
            })
          });

          const data = await res.json();
          if (data.choices) {
            alert("ü§ñ AN√ÅLISE IA:\n\n" + data.choices[0].message.content);
          } else {
            alert("‚ùå Erro da NVIDIA: " + (data.error?.message || "Chave inv√°lida ou sem saldo."));
          }
        } catch(e) {
          alert("‚ùå Erro de Conex√£o: Verifique sua internet.");
        } finally {
          btn.innerText = "ü§ñ IA ANALYST";
          btn.disabled = false;
        }
      }

      function gerarProtocolo() {
        const nav = document.getElementById("nav");
        const cont = document.getElementById("container");
        nav.innerHTML = ""; cont.innerHTML = "";
        ["Treino A", "Treino B", "Treino C"].forEach((t, i) => {
          nav.innerHTML += `<div class="pill ${i==0?'active':''}" onclick="tab(${i})">${t}</div>`;
          const sec = document.createElement("div");
          sec.id = "sec"+i; sec.className = "section "+(i==0?'active':'');
          cont.appendChild(sec);
          criarCard("Supino Reto", "sec"+i);
        });
      }

      function tab(idx) {
        document.querySelectorAll(".section, .pill").forEach(el => el.classList.remove("active"));
        document.getElementById("sec"+idx).classList.add("active");
        document.querySelectorAll(".pill")[idx].classList.add("active");
      }

      window.onload = () => {
        document.getElementById("displayDate").innerText = new Date().toLocaleDateString("pt-BR");
        const saved = localStorage.getItem(KEY_STORAGE);
        if(saved) document.getElementById("apiKeyInput").value = saved;
        gerarProtocolo();
      };
    </script>
  </body>
</html>
