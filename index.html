<script>
  // ... (Mantenha as constantes STORAGE e PDF)

  // 1. SEGURAN√áA: Feedback visual da Chave
  function checkApiKeyStatus() {
    const key = localStorage.getItem(STORAGE.apiKey);
    const input = document.getElementById('apiKeyInput');
    if (key && key.length > 20) {
      input.style.borderColor = "var(--green)";
      return true;
    }
    input.style.borderColor = "var(--red)";
    return false;
  }

  function saveApiKey() {
    const val = document.getElementById('apiKeyInput').value.trim();
    localStorage.setItem(STORAGE.apiKey, val);
    checkApiKeyStatus();
  }

  // 2. CI√äNCIA DO EXERC√çCIO: Brzycki + Autorregula√ß√£o
  function calcularBrzycki(peso, reps, rpe) {
    const K = parseFloat(String(peso || "").replace(",", "."));
    const R = parseFloat(reps);
    const E = parseFloat(rpe);
    
    if (!K || !R) return 0;

    // Se RPE n√£o for preenchido, assume-se esfor√ßo m√°ximo (10)
    // RIR (Repeti√ß√µes em Reserva) = 10 - RPE
    const rir = isNaN(E) ? 0 : (10 - E);
    const esfor√ßoEstimado = R + rir;

    // F√≥rmula de Brzycki: 1RM = Peso / (1.0278 - (0.0278 * Reps))
    const rm = K / (1.0278 - (0.0278 * esfor√ßoEstimado));
    return rm;
  }

  // 3. IA: Nemotron-70B Analyst
  async function enviarParaIA() {
    const key = localStorage.getItem(STORAGE.apiKey);
    if(!key) { 
        alert("‚ùå ERRO DE SEGURAN√áA: Chave NVIDIA ausente. V√° em CONFIG."); 
        openConfig();
        return; 
    }

    const btn = document.querySelector(".btn-ia");
    btn.innerText = "ANALISANDO...";
    
    const dadosTreino = serializeCurrentState();
    
    const promptSistema = {
      role: "system",
      content: "Voc√™ √© um Especialista em Fisiologia do Exerc√≠cio. Analise os dados de e1RM (RM Estimado) e RPE. Identifique se o volume est√° excessivo ou se h√° progress√£o de carga real. Seja direto e t√©cnico."
    };

    try {
      const response = await fetch("https://integrate.api.nvidia.com/v1/chat/completions", {
        method: "POST",
        headers: { 
            "Authorization": `Bearer ${key}`, 
            "Content-Type": "application/json" 
        },
        body: JSON.stringify({
          model: "nvidia/nemotron-70b-instruct",
          messages: [promptSistema, { role: "user", content: JSON.stringify(dadosTreino) }],
          temperature: 0.5,
          max_tokens: 500
        })
      });

      const data = await response.json();
      if(data.choices) {
        alert("üìä AN√ÅLISE TITAN PRO:\n\n" + data.choices[0].message.content);
      } else {
        throw new Error("Resposta inv√°lida da API");
      }
    } catch(e) {
      alert("‚ùå Falha na API: Verifique sua chave ou conex√£o.");
    } finally {
      btn.innerText = "ü§ñ IA ANALYST";
    }
  }

  // ... (Restante das fun√ß√µes de UI)
</script>
