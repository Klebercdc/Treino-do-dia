<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>TITAN PRO | Elite Workout</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #0b1220; --card: #161e2e; --blue: #3182ce;
            --green: #48bb78; --orange: #ed8936; --red: #e53e3e;
            --text: #ffffff; --text-dim: #a0aec0;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            background: var(--bg); color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0; padding-bottom: 100px; -webkit-font-smoothing: antialiased;
        }

        /* HEADER & STATUS */
        header {
            padding: env(safe-area-inset-top) 20px 15px;
            background: rgba(11, 18, 32, 0.8); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .logo { font-size: 1.4rem; font-weight: 900; letter-spacing: -1px; }
        .logo span { color: var(--blue); }
        .stats-top { font-size: 0.7rem; font-weight: 700; color: var(--green); text-transform: uppercase; }

        /* TIMER BOX */
        .timer-container {
            margin: 15px; padding: 20px;
            background: linear-gradient(145deg, #1a2436, #161e2e);
            border-radius: 20px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #timerDisplay { font-size: 3.5rem; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; }
        .timer-presets { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .t-btn { 
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text); padding: 8px 15px; border-radius: 10px; font-weight: 600;
        }
        .t-btn.active { background: var(--blue); border-color: var(--blue); }
        
        .main-btn {
            width: 100%; padding: 15px; border-radius: 15px; border: none;
            font-weight: 800; text-transform: uppercase; cursor: pointer;
            transition: 0.2s;
        }
        .btn-green { background: var(--green); color: #052c16; }

        /* NAV PILLS */
        .nav-scroller {
            display: flex; gap: 12px; padding: 0 15px 15px;
            overflow-x: auto; scrollbar-width: none;
        }
        .nav-scroller::-webkit-scrollbar { display: none; }
        .pill {
            flex: none; padding: 10px 25px; border-radius: 25px;
            background: var(--card); color: var(--text-dim);
            font-weight: 700; font-size: 0.8rem; border: 1px solid transparent;
        }
        .pill.active { background: var(--blue); color: #fff; box-shadow: 0 4px 15px rgba(49, 130, 206, 0.3); }

        /* EXERCISE CARD */
        .exercise-card {
            background: var(--card); margin: 0 15px 15px;
            border-radius: 20px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .ex-info { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .ex-name { font-size: 1.1rem; font-weight: 800; color: var(--blue); }
        .ex-stats { text-align: right; font-size: 0.7rem; color: var(--text-dim); }

        .set-row {
            display: grid; grid-template-columns: 35px 1fr 1fr 1fr 40px;
            gap: 10px; align-items: center; margin-bottom: 12px;
        }
        .set-label { font-size: 0.75rem; font-weight: 800; color: var(--text-dim); text-align: center; }
        .input-group {
            background: #0b1220; border: 1px solid #2d3748;
            border-radius: 10px; padding: 10px 5px; position: relative;
        }
        .input-group.done { border-color: var(--green); background: rgba(72, 187, 120, 0.05); }
        .input-group input {
            background: transparent; border: none; color: #fff;
            width: 100%; text-align: center; font-size: 1rem; font-weight: 700;
        }
        .btn-check { color: var(--text-dim); font-size: 1.2rem; border: none; background: none; }
        .btn-check.active { color: var(--green); }

        /* FOOTER NAV */
        .dock {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(11, 18, 32, 0.95); backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255,255,255,0.05);
            display: grid; grid-template-columns: repeat(4, 1fr);
            padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
            z-index: 1000;
        }
        .dock-item {
            background: none; border: none; color: var(--text-dim);
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            font-size: 0.6rem; font-weight: 700;
        }
        .dock-item.active { color: var(--blue); }
        .dock-item i { font-size: 1.2rem; }

        .btn-finish {
            grid-column: span 1; background: var(--green);
            color: #052c16; border-radius: 12px; margin: 0 5px;
        }

        /* UTILS */
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <div class="logo">TITAN <span>PRO</span></div>
    <div class="stats-top"><i class="fa-solid fa-bolt"></i> <span id="totalVolume">0</span> KG</div>
</header>

<div class="timer-container">
    <div id="timerDisplay">02:00</div>
    <div class="timer-presets">
        <button class="t-btn" onclick="setTimer(60, this)">1m</button>
        <button class="t-btn active" onclick="setTimer(120, this)">2m</button>
        <button class="t-btn" onclick="setTimer(180, this)">3m</button>
    </div>
    <button id="timerCtrl" class="main-btn btn-green" onclick="toggleTimer()">Iniciar Descanso</button>
</div>

<div class="nav-scroller" id="navPills"></div>

<main id="workoutArea"></main>

<div style="padding: 0 15px 30px;">
    <button class="main-btn" style="background: var(--glass); color: var(--blue); border: 1px dashed var(--blue);" onclick="addExercise()">
        <i class="fa-solid fa-plus"></i> Adicionar Exercício
    </button>
</div>

<div class="dock">
    <button class="dock-item active"><i class="fa-solid fa-dumbbell"></i>Treino</button>
    <button class="dock-item" onclick="showHistory()"><i class="fa-solid fa-calendar-days"></i>Histórico</button>
    <button class="dock-item btn-finish" onclick="finishWorkout()">Finalizar</button>
    <button class="dock-item" onclick="openSettings()"><i class="fa-solid fa-gear"></i>Ajustes</button>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let workoutState = {
        volume: 0,
        activeTreino: 0,
        timer: { time: 120, base: 120, running: false, id: null },
        data: []
    };

    const PRESETS = [
        { n: "Treino A", e: ["Supino Inclinado", "Supino Reto", "Desenvolvimento", "Elevação Lateral", "Tríceps Corda"] },
        { n: "Treino B", e: ["Puxada Alta", "Remada Curvada", "Pulldown", "Rosca Direta", "Rosca Martelo"] },
        { n: "Treino C", e: ["Agachamento", "Leg Press", "Extensora", "Mesa Flexora", "Panturrilha"] }
    ];

    // --- CORE FUNCTIONS ---
    function init() {
        renderNav();
        renderWorkout(0);
        loadVolume();
    }

    function renderNav() {
        const nav = document.getElementById("navPills");
        nav.innerHTML = PRESETS.map((t, i) => `
            <div class="pill ${i === 0 ? 'active' : ''}" onclick="switchTreino(${i}, this)">
                ${t.n}
            </div>
        `).join("");
    }

    function switchTreino(idx, el) {
        document.querySelectorAll(".pill").forEach(p => p.classList.remove("active"));
        el.classList.add("active");
        renderWorkout(idx);
    }

    function renderWorkout(idx) {
        const area = document.getElementById("workoutArea");
        const treino = PRESETS[idx];
        area.innerHTML = treino.e.map(ex => createExerciseHTML(ex)).join("");
    }

    function createExerciseHTML(name) {
        return `
            <div class="exercise-card">
                <div class="ex-info">
                    <div>
                        <div class="ex-name">${name}</div>
                        <div class="ex-stats">1RM Est: <span class="rm-val">-</span> kg</div>
                    </div>
                    <button style="background:none; border:none; color:var(--text-dim);" onclick="this.closest('.exercise-card').remove()">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                </div>
                <div class="sets-area">
                    ${[1,2,3].map(s => createSetRow(s)).join("")}
                </div>
                <button onclick="addSet(this)" style="background:none; border:none; color:var(--blue); font-size:0.7rem; font-weight:800; margin-top:10px;">
                    + ADICIONAR SÉRIE
                </button>
            </div>
        `;
    }

    function createSetRow(num) {
        return `
            <div class="set-row">
                <span class="set-label">${num}</span>
                <div class="input-group">
                    <input type="number" placeholder="kg" oninput="calcStats(this)">
                </div>
                <div class="input-group">
                    <input type="number" placeholder="reps" oninput="calcStats(this)">
                </div>
                <div class="input-group">
                    <input type="number" placeholder="RPE">
                </div>
                <button class="btn-check" onclick="toggleDone(this)">
                    <i class="fa-solid fa-circle-check"></i>
                </button>
            </div>
        `;
    }

    // --- LOGIC ---
    function toggleDone(btn) {
        const row = btn.closest(".set-row");
        const groups = row.querySelectorAll(".input-group");
        btn.classList.toggle("active");
        groups.forEach(g => g.classList.toggle("done"));
        
        if(btn.classList.contains("active")) {
            startTimerFromReset();
            calculateTotalVolume();
        }
    }

    function calcStats(input) {
        const card = input.closest(".exercise-card");
        const rows = card.querySelectorAll(".set-row");
        let maxRM = 0;

        rows.forEach(r => {
            const kg = parseFloat(r.querySelector("input[placeholder='kg']").value) || 0;
            const reps = parseFloat(r.querySelector("input[placeholder='reps']").value) || 0;
            if(kg > 0 && reps > 0) {
                const rm = kg * (1 + reps/30); // Epley Formula
                if(rm > maxRM) maxRM = rm;
            }
        });

        if(maxRM > 0) card.querySelector(".rm-val").textContent = Math.round(maxRM);
    }

    function calculateTotalVolume() {
        let total = 0;
        document.querySelectorAll(".set-row").forEach(r => {
            if(r.querySelector(".btn-check").classList.contains("active")) {
                const kg = parseFloat(r.querySelector("input[placeholder='kg']").value) || 0;
                const reps = parseFloat(r.querySelector("input[placeholder='reps']").value) || 0;
                total += (kg * reps);
            }
        });
        document.getElementById("totalVolume").textContent = total.toLocaleString();
    }

    // --- TIMER ---
    function setTimer(s, btn) {
        workoutState.timer.base = workoutState.timer.time = s;
        document.querySelectorAll(".t-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        updateTimerUI();
    }

    function toggleTimer() {
        if(workoutState.timer.running) {
            clearInterval(workoutState.timer.id);
            workoutState.timer.running = false;
            document.getElementById("timerCtrl").textContent = "Continuar Descanso";
        } else {
            workoutState.timer.running = true;
            document.getElementById("timerCtrl").textContent = "Pausar";
            workoutState.timer.id = setInterval(() => {
                if(workoutState.timer.time > 0) {
                    workoutState.timer.time--;
                    updateTimerUI();
                } else {
                    finishTimer();
                }
            }, 1000);
        }
    }

    function startTimerFromReset() {
        clearInterval(workoutState.timer.id);
        workoutState.timer.time = workoutState.timer.base;
        workoutState.timer.running = false;
        toggleTimer();
    }

    function finishTimer() {
        clearInterval(workoutState.timer.id);
        workoutState.timer.running = false;
        document.getElementById("timerCtrl").textContent = "Iniciar Descanso";
        workoutState.timer.time = workoutState.timer.base;
        updateTimerUI();
        navigator.vibrate?.([200, 100, 200]);
    }

    function updateTimerUI() {
        const m = Math.floor(workoutState.timer.time / 60);
        const s = workoutState.timer.time % 60;
        document.getElementById("timerDisplay").textContent = 
            `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function finishWorkout() {
        if(confirm("Deseja finalizar a sessão e salvar no histórico?")) {
            alert("Sessão salva! Volume Total: " + document.getElementById("totalVolume").textContent + " kg");
            location.reload();
        }
    }

    init();
</script>
</body>
</html>
