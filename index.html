<!doctype html>
<html lang="pt-PT">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="theme-color" content="#0b1220" />
    <title>TITAN LOG - Master AI</title>
    <style>
      :root { --bg: #0b1220; --card: #161e2e; --blue: #3182ce; --text: #f7fafc; --orange: #f6ad55; --green: #38b2ac; --red: #e53e3e; }
      body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding-bottom: 20px; }
      
      .top-header { padding: 15px; background: var(--card); border-bottom: 1px solid #2d3748; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
      .date-badge { font-size: 0.8rem; color: var(--orange); font-weight: bold; background: #0b1220; padding: 4px 10px; border-radius: 15px; }
      
      /* CRON√ìMETRO */
      .timer-area { background: #1a202c; padding: 12px; border-bottom: 2px solid var(--blue); text-align: center; }
      #timerDisplay { font-size: 2.2rem; font-weight: 800; color: var(--blue); font-family: monospace; margin-bottom: 8px; }
      .timer-btns { display: flex; gap: 6px; justify-content: center; margin-bottom: 5px; }
      .btn-t { background: #2d3748; color: white; border: none; padding: 8px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: bold; }
      .btn-t.active { background: var(--blue); }
      .btn-ctrl { background: var(--green); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; font-size: 0.8rem; }

      .setup-panel { background: var(--card); padding: 20px; border-bottom: 3px solid var(--blue); }
      .field { margin-bottom: 15px; }
      .field label { font-size: 0.7rem; color: #a0aec0; display: block; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
      .field select { width: 100%; padding: 12px; background: #0b1220; color: white; border: 1px solid var(--blue); border-radius: 8px; font-weight: bold; }

      .nav-pills { display: flex; gap: 8px; padding: 10px; background: var(--bg); overflow-x: auto; border-bottom: 1px solid #2d3748; }
      .pill { flex: none; padding: 12px 20px; border-radius: 8px; background: #1a202c; font-weight: bold; font-size: 0.75rem; border: 1px solid #2d3748; cursor: pointer; color: #a0aec0; }
      .pill.active { background: var(--blue); border-color: var(--blue); color: white; }

      .exercise-card { background: var(--card); border-radius: 12px; padding: 15px; margin: 10px; border: 1px solid #2d3748; animation: fadeIn 0.3s ease; position: relative; }
      .ex-title { font-weight: 800; font-size: 1.1rem; color: var(--blue); text-decoration: underline dotted; cursor: pointer; }
      .ex-target { font-size: 0.75rem; color: var(--orange); font-weight: bold; margin: 4px 0 10px 0; display: block; }
      .remove-ex { position: absolute; top: 10px; right: 10px; color: var(--red); font-size: 1.2rem; cursor: pointer; font-weight: bold; padding: 5px; }
      
      .series-grid { display: grid; grid-template-columns: 40px 1fr 1fr 1fr; gap: 8px; align-items: center; margin-bottom: 8px; }
      .header-grid { text-align: center; font-size: 0.6rem; color: #718096; font-weight: bold; }
      .input-box { background: #0b1220; border: 1px solid #2d3748; border-radius: 6px; padding: 8px 0; }
      .input-box input { background: transparent; border: none; color: #fff; width: 100%; text-align: center; font-size: 1.1rem; outline: none; font-weight: bold; }

      .btn-add-ex { background: #1a202c; color: var(--blue); border: 2px dashed var(--blue); width: calc(100% - 20px); margin: 15px 10px; padding: 15px; border-radius: 12px; font-weight: 800; cursor: pointer; }

      /* RODAP√â AO FINAL (N√ÉO FIXO) */
      .footer-actions { 
        padding: 20px 10px 40px 10px;
        display: flex; 
        gap: 12px; 
        background: transparent;
      }
      .btn { padding: 15px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; flex: 1; text-align: center; font-size: 0.75rem; text-transform: uppercase; }
      .btn-save { background: var(--green); color: white; box-shadow: 0 4px 0 #2d8a84; }
      .btn-save:active { transform: translateY(2px); box-shadow: none; }
      .btn-config { background: #2d3748; color: var(--blue); border: 1px solid var(--blue); }

      dialog { background: #161e2e; color: #fff; border: 1px solid var(--blue); border-radius: 12px; width: 90%; max-width: 400px; padding: 20px; }
      .lib-item { padding: 12px; border-bottom: 1px solid #2d3748; cursor: pointer; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
  </head>
  <body>

    <div class="top-header">
      <h1 style="margin:0; font-size: 1.1rem; color: var(--blue);">TITAN <span style="color:#fff">LOG MASTER</span></h1>
      <div class="date-badge" id="displayDate">03/01/26</div>
    </div>

    <div class="timer-area">
      <div id="timerDisplay">01:00</div>
      <div class="timer-btns">
        <button class="btn-t active" onclick="setT(60, this)">1m</button>
        <button class="btn-t" onclick="setT(120, this)">2m</button>
        <button class="btn-t" onclick="setT(180, this)">3m</button>
        <button class="btn-t" onclick="setT(300, this)">5m</button>
      </div>
      <div class="timer-btns">
        <button id="ctrlBtn" class="btn-ctrl" onclick="toggleT()">INICIAR</button>
        <button class="btn-ctrl" style="background:var(--red)" onclick="resetT()">ZERAR</button>
      </div>
    </div>

    <div class="setup-panel" id="setupPanel">
      <div class="field"><label>Frequ√™ncia Base</label>
        <select id="freq" onchange="gerarProtocolo()">
          <option value="2">2 Dias (Full Body)</option>
          <option value="3" selected>3 Dias (ABC)</option>
          <option value="4">4 Dias (Upper/Lower)</option>
          <option value="6">6 Dias (PPL x2)</option>
        </select>
      </div>
      <div class="field"><label>Objetivo</label>
        <select id="obj" onchange="gerarProtocolo()">
          <option value="hipertrofia">Hipertrofia</option>
          <option value="forca">For√ßa</option>
          <option value="definicao">Defini√ß√£o</option>
        </select>
      </div>
      <button class="btn btn-save" onclick="document.getElementById('setupPanel').style.display='none'">ABRIR PLANILHA</button>
    </div>

    <div class="nav-pills" id="nav"></div>
    
    <main id="container"></main>
    
    <button class="btn-add-ex" onclick="abrirLibParaNovo()">+ ADICIONAR EXERC√çCIO</button>

    <div class="footer-actions">
      <button class="btn btn-config" onclick="document.getElementById('setupPanel').style.display='block'">‚öôÔ∏è CONFIG</button>
      <button class="btn btn-save" onclick="salvarTreino()">SALVAR SESS√ÉO</button>
      <button class="btn btn-config" onclick="verHistorico()" style="flex:0.4">üìú HIST</button>
    </div>

    <dialog id="modalLib">
      <h3 id="libHeader" style="margin:0 0 15px 0; color:var(--orange)">Trocar Exerc√≠cio</h3>
      <div style="margin-bottom:15px; display:flex; gap:5px;">
        <input type="text" id="manualName" placeholder="Nome personalizado..." style="flex:1; padding:10px; border-radius:8px; border:1px solid var(--blue); background:#0b1220; color:white; outline:none;">
        <button onclick="adicionarManual()" style="background:var(--blue); color:white; border:none; border-radius:8px; padding:0 15px; font-weight:bold;">+</button>
      </div>
      <div id="libContent" style="max-height: 300px; overflow-y: auto;"></div>
      <button class="btn" onclick="document.getElementById('modalLib').close()" style="width:100%; margin-top:10px; background:#2d3748; color:white;">Fechar</button>
    </dialog>

    <script>
      let timeLeft = 60, baseTime = 60, timerInt = null, isRunning = false;
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      function playBeep() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.value = 880; gain.gain.value = 0.1;
        osc.start(); osc.stop(audioCtx.currentTime + 0.4);
      }

      function setT(s, btn) {
        if(isRunning) return;
        timeLeft = baseTime = s; updateT();
        document.querySelectorAll('.btn-t').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }

      function updateT() {
        let m = Math.floor(timeLeft/60), s = timeLeft%60;
        document.getElementById('timerDisplay').innerText = `${m}:${s<10?'0':''}${s}`;
      }

      function toggleT() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const btn = document.getElementById('ctrlBtn');
        if(isRunning) {
          clearInterval(timerInt); isRunning = false;
          btn.innerText = "CONTINUAR"; btn.style.background = "var(--green)";
        } else {
          isRunning = true; btn.innerText = "PAUSAR"; btn.style.background = "var(--orange)";
          timerInt = setInterval(() => {
            if(timeLeft > 0) { timeLeft--; updateT(); }
            else { 
              clearInterval(timerInt); isRunning = false;
              playBeep(); setTimeout(playBeep, 600);
              btn.innerText = "INICIAR"; btn.style.background = "var(--green)";
              timeLeft = baseTime; updateT();
            }
          }, 1000);
        }
      }

      function resetT() {
        clearInterval(timerInt); isRunning = false;
        timeLeft = baseTime; updateT();
        document.getElementById('ctrlBtn').innerText = "INICIAR";
        document.getElementById('ctrlBtn').style.background = "var(--green)";
      }

      const biblioteca = {
        "Peito": ["Supino Inclinado", "Supino Reto", "Crossover", "Voador"],
        "Costas": ["Puxada Alta", "Remada Curvada", "Remada Baixa", "Terra"],
        "Pernas": ["Agachamento", "Leg Press 45", "Extensora", "Flexora", "Stiff", "Panturrilha"],
        "Ombros": ["Desenvolvimento", "Eleva√ß√£o Lateral", "Crucifixo Inverso"],
        "Bra√ßos": ["Rosca Direta", "Tr√≠ceps Corda", "Rosca Martelo", "Tr√≠ceps Testa"]
      };

      const divisoes = {
        "2": ["A (Full Body)", "B (Full Body)"],
        "3": ["A (Push)", "B (Pull)", "C (Legs)"],
        "4": ["A (Upper)", "B (Lower)", "C (Upper 2)", "D (Lower 2)"],
        "6": ["A (Push)", "B (Pull)", "C (Legs)", "D (Push 2)", "E (Pull 2)", "F (Legs 2)"]
      };

      let currentExId = null; let isAddingNew = false;

      function gerarProtocolo() {
        const f = document.getElementById('freq').value;
        const nav = document.getElementById('nav');
        const cont = document.getElementById('container');
        nav.innerHTML = ""; cont.innerHTML = "";
        divisoes[f].forEach((nome, i) => {
          nav.innerHTML += `<div class="pill ${i===0?'active':''}" id="p${i}" onclick="tab(${i})">${nome}</div>`;
          let sec = document.createElement('div');
          sec.id = `sec${i}`;
          sec.className = `section ${i===0?'active':''}`;
          cont.appendChild(sec);
          let sug = (nome.includes("Push") || nome.includes("Upper")) ? ["Supino Inclinado", "Desenvolvimento"] : (nome.includes("Pull") ? ["Puxada Alta", "Remada Curvada"] : ["Agachamento", "Leg Press 45"]);
          sug.forEach(ex => criarCard(ex, sec.id));
        });
      }

      function criarCard(nome, sectionId) {
        const o = document.getElementById('obj').value;
        const meta = o==="forca"?"3-5 Reps": (o==="hipertrofia"?"8-12 Reps":"15-20 Reps");
        const sets = o==="forca"?5: (o==="definicao"?3:4);
        const id = 'ex-' + Math.random().toString(36).substr(2, 5);
        const card = document.createElement('div');
        card.className = 'exercise-card';
        card.innerHTML = `
          <span class="remove-ex" onclick="this.parentElement.remove()">√ó</span>
          <span class="ex-title" id="${id}" onclick="abrirLibParaTrocar('${id}')">${nome}</span>
          <span class="ex-target">${sets} Sets x ${meta}</span>
          <div class="series-grid header-grid"><span>SET</span><span>KG</span><span>REPS</span><span>RPE</span></div>
          ${Array.from({length: sets}, (_, s) => `
            <div class="series-grid">
              <span style="font-size:0.7rem; color:#718096; text-align:center;">S${s+1}</span>
              <div class="input-box"><input type="number" inputmode="decimal"></div>
              <div class="input-box"><input type="number"></div>
              <div class="input-box"><input type="number" placeholder="8"></div>
            </div>`).join('')}
        `;
        document.getElementById(sectionId).appendChild(card);
      }

      function abrirLibParaNovo() { isAddingNew = true; document.getElementById('libHeader').innerText = "Adicionar Exerc√≠cio"; mostrarLib(); }
      function abrirLibParaTrocar(id) { isAddingNew = false; currentExId = id; document.getElementById('libHeader').innerText = "Trocar Exerc√≠cio"; mostrarLib(); }

      function mostrarLib() {
        const lib = document.getElementById('libContent');
        lib.innerHTML = "";
        for (let cat in biblioteca) {
          lib.innerHTML += `<div style="color:var(--blue); font-weight:bold; margin:15px 0 5px; border-bottom:1px solid #2d3748">${cat}</div>`;
          biblioteca[cat].forEach(ex => { lib.innerHTML += `<div class="lib-item" onclick="selecionar('${ex}')">${ex}</div>`; });
        }
        document.getElementById('modalLib').showModal();
      }

      function selecionar(n) {
        if(isAddingNew) { criarCard(n, document.querySelector('.section.active').id); } 
        else { document.getElementById(currentExId).innerText = n; }
        document.getElementById('modalLib').close();
      }

      function adicionarManual() {
        const val = document.getElementById('manualName').value;
        if(val) { selecionar(val); document.getElementById('manualName').value = ""; }
      }

      function tab(idx) {
        document.querySelectorAll('.section, .pill').forEach(el => el.classList.remove('active'));
        document.getElementById(`sec${idx}`).classList.add('active');
        document.getElementById(`p${idx}`).classList.add('active');
      }

      function salvarTreino() { alert("‚úÖ Treino Salvo!"); }
      function verHistorico() { alert("Hist√≥rico de Progress√£o Ativo."); }
      window.onload = () => { gerarProtocolo(); document.getElementById('displayDate').innerText = new Date().toLocaleDateString('pt-PT'); };
    </script>
  </body>
</html>
