<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="theme-color" content="#0b1220" />
    <title>TITAN LOG PRO</title>
    <style>
      :root { --bg: #0b1220; --card: #161e2e; --blue: #3182ce; --text: #f7fafc; --orange: #f6ad55; --green: #38b2ac; --red: #e53e3e; }
      body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding-bottom: 50px; }
      .topbar { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #2d3748; }
      .period-selector { background: var(--card); padding: 12px; border-bottom: 2px solid var(--blue); display: flex; align-items: center; justify-content: center; gap: 10px; }
      .period-selector select { background: #0b1220; color: var(--orange); border: 1px solid var(--orange); border-radius: 5px; padding: 8px; font-weight: bold; width: 65%; font-size: 0.9rem; }
      .nav-pills { display: flex; gap: 8px; padding: 10px; background: var(--bg); position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #2d3748; }
      .pill { flex: 1; text-align: center; padding: 12px; border-radius: 8px; background: #1a202c; font-weight: bold; font-size: 0.8rem; border: 1px solid #2d3748; cursor: pointer; color: #a0aec0; }
      .pill.active { background: var(--blue); border-color: var(--blue); color: white; }
      .exercise-card { background: var(--card); border-radius: 12px; padding: 15px; margin: 10px; border: 1px solid #2d3748; }
      .ex-title { font-weight: 800; font-size: 1.1rem; color: var(--blue); margin-bottom: 2px; }
      .ex-target { font-size: 0.9rem; color: var(--orange); font-weight: bold; margin-bottom: 4px; display: block; }
      .ex-meta { font-size: 0.75rem; color: #a0aec0; margin-bottom: 12px; text-transform: uppercase; }
      .series-header { display: grid; grid-template-columns: 40px 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; text-align: center; }
      .series-header span { font-size: 0.65rem; color: #718096; font-weight: bold; }
      .series-row { display: grid; grid-template-columns: 40px 1fr 1fr 1fr; gap: 8px; align-items: center; margin-bottom: 8px; }
      .s-label { font-weight: bold; color: #718096; font-size: 0.85rem; text-align: center; }
      .input-box { background: #0b1220; border: 1px solid #2d3748; border-radius: 6px; padding: 8px 0; }
      .input-box input { background: transparent; border: none; color: #fff; width: 100%; text-align: center; font-size: 1.1rem; outline: none; font-weight: bold; }
      .section { display: none; }
      .section.active { display: block; }
      .footer-row { display: flex; justify-content: space-between; align-items: center; padding: 20px 10px; gap: 10px; }
      .btn { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; flex: 1; text-align: center; font-size: 0.9rem; transition: 0.2s; }
      .btn.primary { background: var(--green); color: #fff; }
      .btn.secondary { background: #2d3748; color: #fff; }
      
      /* Estilo do Modal de Histórico */
      dialog { background: #161e2e; color: #fff; border: 1px solid var(--blue); border-radius: 12px; padding: 20px; width: 90%; max-width: 500px; }
      dialog::backdrop { background: rgba(0,0,0,0.8); }
      .hist-item { border-bottom: 1px solid #2d3748; padding: 12px 0; }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div><h1 style="margin:0; font-size: 1.4rem;">TITAN LOG</h1><div id="todayLabel" style="font-size: 0.8rem; color: #718096;">...</div></div>
      <button class="btn secondary" style="flex:none; padding: 8px 12px;" id="btnHistory">Histórico</button>
    </header>

    <div class="period-selector">
      <span>Fase:</span>
      <select id="periodoFase" onchange="buildTreino()">
        <option value="hipertrofia">HIPERTROFIA (8-12 Reps)</option>
        <option value="forca">FORÇA (5-8 Reps)</option>
        <option value="metabolico">METABÓLICO (15-20 Reps)</option>
        <option value="deload">DELOAD (Recuperação)</option>
      </select>
    </div>

    <div class="nav-pills">
      <div class="pill active" id="pillA" onclick="tab('A')">TREINO A</div>
      <div class="pill" id="pillB" onclick="tab('B')">TREINO B</div>
      <div class="pill" id="pillC" onclick="tab('C')">TREINO C</div>
    </div>

    <main id="mainContainer">
      <div id="A" class="section active"></div>
      <div id="B" class="section"></div>
      <div id="C" class="section"></div>
    </main>

    <div class="footer-row">
      <button class="btn secondary" id="btnCopy">Copiar</button>
      <button class="btn primary" id="btnSave">Salvar Hoje</button>
    </div>

    <dialog id="modalHistory">
        <h3 style="margin-top:0; color: var(--blue);">Histórico Recente</h3>
        <div id="historyContent" style="max-height: 350px; overflow-y: auto;"></div>
        <button class="btn secondary" onclick="document.getElementById('modalHistory').close()" style="width:100%; margin-top:15px;">Fechar</button>
        <button onclick="limparHistorico()" style="width:100%; margin-top:10px; background:none; border:none; color:var(--red); font-size:0.7rem; cursor:pointer;">APAGAR TUDO</button>
    </dialog>

    <script>
      const baseData = {
        A: [ { n: "1. Agachamento / Leg 45", s: 4, m: "Quadricípete" }, { n: "2. Supino Inclinado", s: 4, m: "Peitoral Sup." }, { n: "3. Desenv. Militar", s: 3, m: "Ombros" }, { n: "4. Fundos / Testa", s: 3, m: "Tríceps" }, { n: "5. Cadeira Extensora", s: 3, m: "Isolamento" } ],
        B: [ { n: "1. Terra ou Stiff", s: 4, m: "Posterior" }, { n: "2. Remada Curvada", s: 4, m: "Dorsal" }, { n: "3. Puxada Alta", s: 3, m: "Costas" }, { n: "4. Face Pull", s: 3, m: "Ombro Post." }, { n: "5. Rosca Direta", s: 3, m: "Bíceps" } ],
        C: [ { n: "1A. Leg Press Horiz.", s: 3, m: "Superset" }, { n: "1B. Flexão de Braços", s: 3, m: "Superset" }, { n: "2A. Afundo / Passada", s: 3, m: "Superset" }, { n: "2B. Elevação Lateral", s: 3, m: "Superset" }, { n: "3A. Remada Máquina", s: 3, m: "Superset" }, { n: "3B. Tríceps Corda", s: 3, m: "Superset" }, { n: "4. Cadeira Flexora", s: 4, m: "Isolamento" } ]
      };

      const fases = {
        hipertrofia: { reps: "8-12", rpe: "8-9", mod_s: 0 },
        forca: { reps: "5-8", rpe: "9-10", mod_s: 0 },
        metabolico: { reps: "15-20", rpe: "10", mod_s: 1 },
        deload: { reps: "10-12", rpe: "6", mod_s: -1 }
      };

      function tab(treinoId) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
        document.getElementById(treinoId).classList.add('active');
        document.getElementById('pill' + treinoId).classList.add('active');
      }

      function buildTreino() {
        const fase = document.getElementById('periodoFase').value;
        const conf = fases[fase];
        ['A', 'B', 'C'].forEach(id => {
          const container = document.getElementById(id);
          container.innerHTML = "";
          baseData[id].forEach(ex => {
            const numSeries = Math.max(2, ex.s + conf.mod_s);
            let cardHtml = `<div class="exercise-card"><div class="ex-title">${ex.n}</div><div class="ex-target">META: ${conf.reps} REPS | RPE ${conf.rpe}</div><div class="ex-meta">${ex.m} | ${numSeries} Séries</div><div class="series-header"><span>SÉRIE</span><span>KG</span><span>REPS</span><span>RPE</span></div>`;
            for (let i = 1; i <= numSeries; i++) {
              cardHtml += `<div class="series-row"><div class="s-label">S${i}</div><div class="input-box"><input type="number" inputmode="decimal" placeholder="-"></div><div class="input-box"><input type="number" inputmode="numeric" placeholder="-"></div><div class="input-box"><input type="number" inputmode="numeric" placeholder="-"></div></div>`;
            }
            container.innerHTML += cardHtml + `</div>`;
          });
        });
      }

      // LÓGICA DE SALVAMENTO
      document.getElementById('btnSave').addEventListener('click', function() {
          const treinoAtivo = document.querySelector('.section.active').id;
          const cards = document.querySelectorAll(`#${treinoAtivo} .exercise-card`);
          let logs = [];

          cards.forEach(card => {
              const nome = card.querySelector('.ex-title').innerText;
              card.querySelectorAll('.series-row').forEach((linha, i) => {
                  const inputs = linha.querySelectorAll('input');
                  if (inputs[1].value) { // Se preencheu reps
                      logs.push({ ex: nome, s: i+1, kg: inputs[0].value || "0", reps: inputs[1].value, rpe: inputs[2].value || "-" });
                  }
              });
          });

          if (logs.length === 0) return alert("Preenche as repetições primeiro!");

          let historico = JSON.parse(localStorage.getItem('titan_log') || '[]');
          historico.unshift({ data: new Date().toLocaleString('pt-PT'), treino: treinoAtivo, dados: logs });
          localStorage.setItem('titan_log', JSON.stringify(historico.slice(0, 20))); // Guarda os últimos 20
          alert("✅ Treino guardado no Histórico!");
      });

      // LÓGICA DE HISTÓRICO
      document.getElementById('btnHistory').addEventListener('click', function() {
          const hist = JSON.parse(localStorage.getItem('titan_log') || '[]');
          const content = document.getElementById('historyContent');
          if (hist.length === 0) content.innerHTML = "<p>Sem treinos guardados.</p>";
          else {
              content.innerHTML = hist.map(h => `
                  <div class="hist-item">
                      <div style="color:var(--orange); font-weight:bold;">${h.data} (Treino ${h.treino})</div>
                      ${h.dados.map(d => `<div style="font-size:0.75rem;">${d.ex} S${d.s}: ${d.kg}kg x ${d.reps} (RPE ${d.rpe})</div>`).join('')}
                  </div>
              `).join('');
          }
          document.getElementById('modalHistory').showModal();
      });

      function limparHistorico() { if(confirm("Apagar tudo?")) { localStorage.removeItem('titan_log'); location.reload(); } }

      // COPIAR WHATSAPP
      document.getElementById('btnCopy').addEventListener('click', function() {
          const treinoAtivo = document.querySelector('.section.active').id;
          let txt = `*TITAN LOG - ${treinoAtivo}*\n`;
          document.querySelectorAll(`#${treinoAtivo} .exercise-card`).forEach(card => {
              let sTxt = "";
              card.querySelectorAll('.series-row').forEach((l, i) => {
                  const inp = l.querySelectorAll('input');
                  if (inp[1].value) sTxt += ` S${i+1}: ${inp[0].value}kg x ${inp[1].value} (RPE ${inp[2].value})\n`;
              });
              if (sTxt) txt += `\n*${card.querySelector('.ex-title').innerText}*\n${sTxt}`;
          });
          navigator.clipboard.writeText(txt).then(() => alert("Copiado!"));
      });

      window.onload = () => { buildTreino(); document.getElementById('todayLabel').innerText = new Date().toLocaleDateString('pt-PT', { weekday: 'long', day: 'numeric' }); };
    </script>
  </body>
</html>
