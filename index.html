<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="theme-color" content="#0b1220" />
    <title>TITAN PRO - Master Edition</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';</script>

    <style>
      :root { --bg:#0b1220; --card:#161e2e; --blue:#3182ce; --text:#f7fafc; --orange:#f6ad55; --green:#38b2ac; --red:#e53e3e; }
      body { background:var(--bg); color:var(--text); font-family:-apple-system,sans-serif; margin:0; padding-bottom:20px; user-select:none; -webkit-user-select:none; }

      .top-header { padding:15px; background:var(--card); border-bottom:1px solid #2d3748; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:100; }
      .date-badge { font-size:.8rem; color:var(--orange); font-weight:bold; background:#0b1220; padding:4px 10px; border-radius:15px; }
      
      .timer-area { background:#1a202c; padding:12px; border-bottom:2px solid var(--blue); text-align:center; }
      #timerDisplay { font-size:2.2rem; font-weight:800; color:var(--blue); font-family:monospace; margin-bottom:8px; }
      .timer-btns { display:flex; gap:6px; justify-content:center; margin-bottom:5px; }
      .btn-t { background:#2d3748; color:#fff; border:none; padding:8px 12px; border-radius:8px; font-size:.75rem; cursor:pointer; font-weight:bold; }
      .btn-t.active { background:var(--blue); }
      .btn-ctrl { background:var(--green); color:#fff; border:none; padding:10px 20px; border-radius:8px; font-weight:bold; font-size:.8rem; }

      .setup-panel { background:var(--card); padding:20px; border-bottom:3px solid var(--blue); display:block; }
      .field label { font-size:.7rem; color:#a0aec0; display:block; margin-bottom:5px; font-weight:bold; text-transform:uppercase; }
      .field select { width:100%; padding:12px; background:#0b1220; color:#fff; border:1px solid var(--blue); border-radius:8px; font-weight:bold; }

      .nav-pills { display:flex; gap:8px; padding:10px; background:var(--bg); overflow-x:auto; border-bottom:1px solid #2d3748; }
      .pill { flex:none; padding:12px 20px; border-radius:8px; background:#1a202c; font-weight:bold; font-size:.75rem; border:1px solid #2d3748; cursor:pointer; color:#a0aec0; transition: transform 0.1s; }
      .pill.active { background:var(--blue); border-color:var(--blue); color:#fff; }

      .exercise-card { background:var(--card); border-radius:12px; padding:15px; margin:10px; border:1px solid #2d3748; animation:fadeIn .3s ease; position:relative; }
      .ex-title { font-weight:800; font-size:1.1rem; color:var(--blue); text-decoration:underline dotted; cursor:pointer; }
      .rpe-suggest { display:block; font-size:0.7rem; color:var(--green); margin-bottom:10px; font-family:monospace; }

      .series-grid { display:grid; grid-template-columns:40px 1fr 1fr 1fr; gap:8px; align-items:center; margin-bottom:8px; }
      .input-box { background:#0b1220; border:1px solid #2d3748; border-radius:6px; padding:8px 0; }
      .input-box.filled { border-color: var(--green); }
      .input-box input { background:transparent; border:none; color:#fff; width:100%; text-align:center; font-size:1.1rem; outline:none; font-weight:bold; }
      .input-box input::placeholder { color: rgba(255,255,255,0.1); }

      .footer-actions { padding:20px 10px 40px 10px; display:flex; gap:12px; background:transparent; flex-wrap:wrap;}
      .btn { padding:15px; border-radius:10px; border:none; font-weight:800; cursor:pointer; flex:1; text-align:center; font-size:.75rem; text-transform:uppercase; display: flex; align-items: center; justify-content: center; gap: 5px; }
      .btn-save { background:var(--green); color:#fff; }
      .btn-config { background:#2d3748; color:var(--blue); border:1px solid var(--blue); }

      dialog { background:#161e2e; color:#fff; border:1px solid var(--blue); border-radius:12px; width:90%; max-width:500px; padding:20px; border: 1px solid var(--blue); }
      dialog::backdrop { background: rgba(0,0,0,0.8); }
      #csvTextarea { width:100%; height:180px; padding:12px; background:#0b1220; border:1px solid var(--blue); border-radius:8px; color:#fff; font-family:monospace; font-size:.8rem; margin-bottom:12px; box-sizing: border-box; }
      
      .csv-buttons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
      
      @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to { opacity:1; transform:translateY(0);} }
    </style>
  </head>

  <body>
    <div class="top-header">
      <div class="header-left"><h1 style="margin:0; font-size:1.1rem; color:var(--blue);">TITAN <span style="color:#fff">PRO</span></h1></div>
      <div class="date-badge" id="displayDate">--/--/--</div>
    </div>

    <div class="timer-area">
      <div id="timerDisplay">01:00</div>
      <div class="timer-btns">
        <button class="btn-t active" onclick="setT(60, this)">1m</button>
        <button class="btn-t" onclick="setT(120, this)">2m</button>
        <button class="btn-t" onclick="setT(180, this)">3m</button>
      </div>
      <div class="timer-btns">
        <button id="ctrlBtn" class="btn-ctrl" onclick="toggleT()">INICIAR</button>
        <button class="btn-ctrl" style="background:var(--red)" onclick="resetT()">ZERAR</button>
      </div>
    </div>

    <div class="setup-panel" id="setupPanel">
      <div class="field"><label>Frequ√™ncia Semanal</label><select id="freq" onchange="gerarProtocolo()"><option value="3">3 Dias (ABC)</option><option value="4">4 Dias (Upper/Lower)</option><option value="5">5 Dias (ABCDE)</option></select></div>
      <button class="btn btn-config" onclick="limparApenasValores()" style="width:100%; border:1px solid var(--red); color:var(--red); margin-bottom:10px;">‚ôªÔ∏è LIMPAR CARGAS</button>
      <button class="btn btn-save" onclick="closeConfig()">ABRIR TREINO</button>
    </div>

    <div class="nav-pills" id="nav"></div>
    <main id="container"></main>
    <button class="btn btn-config" style="margin: 10px; width: calc(100% - 20px); background: #1a202c; border: 2px dashed var(--blue);" onclick="abrirLibParaNovo()">+ ADICIONAR EXERC√çCIO</button>

    <div class="footer-actions">
      <button class="btn btn-config" onclick="openConfig()">‚öôÔ∏è CONFIG</button>
      <button class="btn btn-config" onclick="showAnalytics()">üìà EVOLU√á√ÉO</button>
      <button class="btn btn-save" onclick="salvarTreino()">SALVAR SESS√ÉO</button>
      <button class="btn btn-config" onclick="abrirCSVModal()" style="background:var(--orange); color:white; border:none;">üìä ARQUIVOS</button>
      <button class="btn btn-config" onclick="verHistorico()">üìú HIST</button>
    </div>

    <dialog id="modalCSV">
      <h3 style="margin:0 0 15px 0; color:var(--orange)">Arquivos & Modelos</h3>
      <textarea id="csvTextarea" placeholder="Cole CSV ou texto extra√≠do..."></textarea>
      <div class="csv-buttons">
        <label class="btn" style="background:var(--blue); color:white;">üìÑ PDF<input type="file" accept=".pdf" style="display:none" onchange="extrairTextoPDF(this)"></label>
        <button class="btn" style="background:var(--green); color:white;" onclick="importarCSV()">IMPORTAR</button>
        <button class="btn btn-config" onclick="fazerBackup()">‚òÅÔ∏è BACKUP</button>
        <button class="btn" style="background:var(--green); color:white;" onclick="salvarModelo()">üíæ SALVAR MOD</button>
        <button class="btn btn-config" onclick="verModelos()">üìö MODELOS</button>
        <button class="btn btn-config" onclick="document.getElementById('modalCSV').close()">FECHAR</button>
      </div>
      <div id="modelosLista" style="margin-top:15px; max-height:150px; overflow-y:auto; display:none; border-top:1px solid #2d3748; padding-top:10px;"></div>
    </dialog>

    <script>
      const STORAGE = { draft: "titan_m_draft", hist: "titan_m_hist", mods: "titan_m_mods" };
      // ... restante da l√≥gica mantida conforme vers√£o master anterior ...
      // Certifique-se de usar a l√≥gica da vers√£o Master anterior para garantir o funcionamento de todas as ferramentas.
      
      /* Fun√ß√µes de inicializa√ß√£o e controle resumidas abaixo para refer√™ncia */
      let timeLeft = 60, baseTime = 60, timerInt = null, isRunning = false;
      function setT(s, btn) { timeLeft = baseTime = s; updateT(); document.querySelectorAll(".btn-t").forEach(b => b.classList.remove("active")); btn.classList.add("active"); }
      function updateT() { const m = Math.floor(timeLeft / 60); const s = timeLeft % 60; document.getElementById("timerDisplay").innerText = `${m}:${s < 10 ? '0' : ''}${s}`; }
      function toggleT() {
        const btn = document.getElementById("ctrlBtn");
        if (isRunning) { clearInterval(timerInt); isRunning = false; btn.innerText = "INICIAR"; } 
        else { isRunning = true; btn.innerText = "PAUSAR"; timerInt = setInterval(() => { if (timeLeft > 0) { timeLeft--; updateT(); } else { clearInterval(timerInt); isRunning = false; btn.innerText = "INICIAR"; timeLeft = baseTime; updateT(); } }, 1000); }
      }
      function resetT() { clearInterval(timerInt); isRunning = false; timeLeft = baseTime; updateT(); }
      
      // As demais fun√ß√µes como criarCard, salvarTreino, importarCSV e showAnalytics 
      // devem ser mantidas conforme o bloco Master que enviamos anteriormente.
      
      window.onload = () => {
        document.getElementById("displayDate").innerText = new Date().toLocaleDateString("pt-BR");
        gerarProtocolo(); // Ou l√≥gica de carregamento de draft
      };
    </script>
  </body>
</html>
