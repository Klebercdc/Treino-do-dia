<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="theme-color" content="#0b1220" />
    <title>TITAN PRO - Backup Master</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';</script>

    <link rel="icon" href="Logo.png" type="image/png" />

    <style>
      :root { --bg:#0b1220; --card:#161e2e; --blue:#3182ce; --text:#f7fafc; --orange:#f6ad55; --green:#38b2ac; --red:#e53e3e; }
      body { background:var(--bg); color:var(--text); font-family:-apple-system,sans-serif; margin:0; padding-bottom:20px; user-select:none; }

      /* HEADER */
      .top-header { padding:15px; background:var(--card); border-bottom:1px solid #2d3748; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:100; }
      .date-badge { font-size:.8rem; color:var(--orange); font-weight:bold; background:#0b1220; padding:4px 10px; border-radius:15px; }
      .logo-img { height:40px; filter:drop-shadow(0 0 5px var(--blue)); }

      /* TIMER */
      .timer-area { background:#1a202c; padding:12px; border-bottom:2px solid var(--blue); text-align:center; }
      #timerDisplay { font-size:2.2rem; font-weight:800; color:var(--blue); font-family:monospace; }
      .timer-btns { display:flex; gap:6px; justify-content:center; margin-top:5px; }
      .btn-t { background:#2d3748; color:#fff; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; }
      .btn-t.active { background:var(--blue); }
      .btn-ctrl { background:var(--green); color:#fff; border:none; padding:10px 20px; border-radius:8px; font-weight:bold; }

      /* PILLS & CARDS */
      .nav-pills { display:flex; gap:8px; padding:10px; overflow-x:auto; background:var(--bg); }
      .pill { flex:none; padding:12px 20px; border-radius:8px; background:#1a202c; font-weight:bold; font-size:.75rem; color:#a0aec0; border:1px solid #2d3748; }
      .pill.active { background:var(--blue); color:#fff; }

      .exercise-card { background:var(--card); border-radius:12px; padding:15px; margin:10px; border:1px solid #2d3748; }
      .ex-title { font-weight:800; font-size:1.1rem; color:var(--blue); text-decoration: underline dotted; }

      .series-grid { display:grid; grid-template-columns:40px 1fr 1fr 1fr; gap:8px; align-items:center; margin-bottom:6px; }
      .input-box { background:#0b1220; border:1px solid #2d3748; border-radius:6px; padding:6px 0; }
      .input-box.filled { border-color: var(--green); }
      .input-box input { background:transparent; border:none; color:#fff; width:100%; text-align:center; font-size:1.1rem; outline:none; font-weight:bold; }
      .input-box input::placeholder { color: rgba(255,255,255,0.1); }

      /* FOOTER & MODALS */
      .footer-actions { padding:15px; display:flex; gap:10px; flex-wrap:wrap; }
      .btn { padding:15px; border-radius:10px; border:none; font-weight:800; cursor:pointer; flex:1; font-size:.75rem; text-transform:uppercase; text-align:center;}
      .btn-save { background:var(--green); color:#fff; }
      .btn-config { background:#2d3748; color:var(--blue); border:1px solid var(--blue); }
      
      /* Alerta de Backup no bot칚o */
      .backup-alert { border: 2px solid var(--orange) !important; animation: pulse 2s infinite; }
      @keyframes pulse { 0% { box-shadow: 0 0 0 0px rgba(246, 173, 85, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(246, 173, 85, 0); } 100% { box-shadow: 0 0 0 0px rgba(246, 173, 85, 0); } }

      dialog { background:#161e2e; color:#fff; border:1px solid var(--blue); border-radius:12px; width:92%; max-width:500px; padding:20px; }
      dialog::backdrop { background: rgba(0,0,0,0.85); }
      #csvTextarea { width:100%; height:150px; background:#0b1220; color:white; border:1px solid var(--blue); border-radius:8px; padding:10px; font-family:monospace; }
    </style>
  </head>

  <body>
    <div class="top-header">
      <div style="display:flex; align-items:center; gap:10px;"><img src="Logo.png" class="logo-img"> <h1 style="margin:0; font-size:1.1rem;">TITAN <span style="color:var(--blue)">PRO</span></h1></div>
      <div class="date-badge" id="displayDate">--/--/--</div>
    </div>

    <div class="timer-area">
      <div id="timerDisplay">01:00</div>
      <div class="timer-btns">
        <button class="btn-t active" onclick="setT(60, this)">1m</button>
        <button class="btn-t" onclick="setT(120, this)">2m</button>
        <button class="btn-t" onclick="setT(180, this)">3m</button>
      </div>
      <div class="timer-btns">
        <button id="ctrlBtn" class="btn-ctrl" onclick="toggleT()">INICIAR</button>
        <button class="btn-ctrl" style="background:var(--red)" onclick="resetT()">ZERAR</button>
      </div>
    </div>

    <div class="nav-pills" id="nav"></div>
    <main id="container"></main>

    <div class="footer-actions">
      <button class="btn btn-config" onclick="showAnalytics()">游늳 EVOLU칂츾O</button>
      <button class="btn btn-save" onclick="salvarTreino()">SALVAR SESS츾O</button>
      <button id="btnArquivos" class="btn btn-config" onclick="abrirCSVModal()" style="background:var(--orange); color:white; border:none;">游늵 ARQUIVOS</button>
    </div>

    <dialog id="modalCSV">
      <h3 style="margin:0 0 15px 0; color:var(--orange)">Backup & Importa칞칚o</h3>
      <p style="font-size: 0.7rem; color: #a0aec0; margin-bottom: 10px;">Cole o texto de um backup para restaurar ou use o bot칚o para salvar seu progresso.</p>
      <textarea id="csvTextarea" placeholder="Conte칰do do Backup JSON ou CSV..."></textarea>
      <div style="display:flex; flex-direction:column; gap:8px; margin-top:10px;">
        <div style="display:flex; gap:8px;">
          <button class="btn btn-save" onclick="fazerBackup()">BAIXAR BACKUP</button>
          <button class="btn btn-config" style="background: var(--blue); color:white" onclick="restaurarBackup()">RESTAURAR</button>
        </div>
        <button class="btn" onclick="document.getElementById('modalCSV').close()" style="background:#2d3748; color:white;">FECHAR</button>
      </div>
    </dialog>

    <script>
      const STORAGE = { draft: "titan_v10_draft", hist: "titan_v10_hist", lastBackup: "titan_v10_lastback" };

      /* --- L칍GICA DE BACKUP --- */
      function abrirCSVModal() { 
        document.getElementById("modalCSV").showModal(); 
      }

      function fazerBackup() {
        const data = {
          draft: localStorage.getItem(STORAGE.draft),
          hist: localStorage.getItem(STORAGE.hist),
          backupDate: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `TITAN_PRO_DATA_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        
        localStorage.setItem(STORAGE.lastBackup, new Date().toISOString());
        checkBackupStatus();
        alert("Backup conclu칤do! Guarde este arquivo em local seguro.");
      }

      function restaurarBackup() {
        const text = document.getElementById("csvTextarea").value;
        if(!text) return alert("Cole o conte칰do do arquivo de backup.");
        try {
          const data = JSON.parse(text);
          if(data.draft) localStorage.setItem(STORAGE.draft, data.draft);
          if(data.hist) localStorage.setItem(STORAGE.hist, data.hist);
          alert("Dados restaurados com sucesso! O app ir치 recarregar.");
          location.reload();
        } catch(e) {
          alert("Erro: Formato de backup inv치lido.");
        }
      }

      function checkBackupStatus() {
        const last = localStorage.getItem(STORAGE.lastBackup);
        const btn = document.getElementById("btnArquivos");
        if(!last) {
          btn.classList.add("backup-alert");
          return;
        }
        const diffDays = (new Date() - new Date(last)) / (1000 * 60 * 60 * 24);
        if(diffDays > 7) btn.classList.add("backup-alert");
        else btn.classList.remove("backup-alert");
      }

      /* --- CORE ENGINE --- */
      let timeLeft = 60, baseTime = 60, timerInt = null, isRunning = false;
      function setT(s, btn) { timeLeft = baseTime = s; updateT(); document.querySelectorAll(".btn-t").forEach(b => b.classList.remove("active")); btn.classList.add("active"); }
      function updateT() { const m = Math.floor(timeLeft / 60); const s = timeLeft % 60; document.getElementById("timerDisplay").innerText = `${m}:${s < 10 ? '0' : ''}${s}`; }
      function toggleT() {
        const btn = document.getElementById("ctrlBtn");
        if (isRunning) { clearInterval(timerInt); isRunning = false; btn.innerText = "INICIAR"; } 
        else { isRunning = true; btn.innerText = "PAUSAR"; timerInt = setInterval(() => { if (timeLeft > 0) { timeLeft--; updateT(); } else { clearInterval(timerInt); isRunning = false; btn.innerText = "INICIAR"; timeLeft = baseTime; updateT(); } }, 1000); }
      }
      function resetT() { clearInterval(timerInt); isRunning = false; timeLeft = baseTime; updateT(); }

      function criarCard(nome, sectionId, values = null) {
        const id = "ex-" + Math.random().toString(36).substr(2, 5);
        const card = document.createElement("div");
        card.className = "exercise-card";
        card.setAttribute("data-name", nome);
        let rows = "";
        for(let s=0; s<4; s++){
          const v = values?.[s] || {kg:"", reps:"", rpe:""};
          rows += `<div class="series-grid"><span style="font-size:.6rem;color:#718096">S${s+1}</span>
            <div class="input-box ${v.kg?'filled':''}"><input type="number" value="${v.kg}" oninput="saveDraft()"></div>
            <div class="input-box ${v.reps?'filled':''}"><input type="number" value="${v.reps}" oninput="saveDraft()"></div>
            <div class="input-box"><input type="number" value="${v.rpe}" oninput="saveDraft()"></div></div>`;
        }
        card.innerHTML = `<span class="ex-title">${nome}</span><div class="series-grid header-grid"><span>SET</span><span>KG</span><span>REPS</span><span>RPE</span></div>${rows}`;
        document.getElementById(sectionId).appendChild(card);
      }

      function saveDraft() {
        const state = { sections: Array.from(document.querySelectorAll(".section")).map(sec => ({
          cards: Array.from(sec.querySelectorAll(".exercise-card")).map(c => ({
            name: c.getAttribute("data-name"),
            values: Array.from(c.querySelectorAll(".series-grid:not(.header-grid)")).map(r => {
              const i = r.querySelectorAll("input");
              return { kg: i[0].value, reps: i[1].value, rpe: i[2].value };
            })
          }))
        }))};
        localStorage.setItem(STORAGE.draft, JSON.stringify(state));
      }

      function salvarTreino() {
        saveDraft();
        const d = JSON.parse(localStorage.getItem(STORAGE.draft));
        const h = JSON.parse(localStorage.getItem(STORAGE.hist) || "[]");
        h.unshift({ date: new Date(), state: d });
        localStorage.setItem(STORAGE.hist, JSON.stringify(h.slice(0,50)));
        alert("Sess칚o Salva no Hist칩rico!");
      }

      function gerarProtocolo() {
        const cont = document.getElementById("container"); const nav = document.getElementById("nav");
        cont.innerHTML = ""; nav.innerHTML = "";
        ["A", "B", "C"].forEach((l, i) => {
          nav.innerHTML += `<div class="pill ${i===0?'active':''}" onclick="tab(${i})">TREINO ${l}</div>`;
          const sec = document.createElement("div"); sec.id = `sec${i}`; sec.className = `section`;
          sec.style.display = i===0?"block":"none"; cont.appendChild(sec);
          if(i===0) ["Supino", "Crucifixo"].forEach(ex => criarCard(ex, sec.id));
        });
      }

      function tab(i) {
        document.querySelectorAll(".section").forEach(s => s.style.display = "none");
        document.querySelectorAll(".pill").forEach(p => p.classList.remove("active"));
        document.querySelectorAll(".section")[i].style.display = "block";
        document.querySelectorAll(".pill")[i].classList.add("active");
      }

      function showAnalytics() { alert("An치lise de progresso carregando..."); }

      window.onload = () => {
        document.getElementById("displayDate").innerText = new Date().toLocaleDateString("pt-BR");
        gerarProtocolo();
        checkBackupStatus();
      };
    </script>
  </body>
</html>
