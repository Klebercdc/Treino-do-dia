<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>TITAN PRO | Elite Performance</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #0b1220; --card: #161e2e; --blue: #3182ce;
            --green: #48bb78; --orange: #ed8936; --red: #e53e3e;
            --text: #ffffff; --text-dim: #a0aec0;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body {
            background: var(--bg); color: var(--text);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding-bottom: 110px; overscroll-behavior-y: none;
        }

        header {
            padding: env(safe-area-inset-top) 20px 15px;
            background: rgba(11, 18, 32, 0.9); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .timer-box {
            margin: 15px; padding: 20px;
            background: linear-gradient(145deg, #1a2436, #161e2e);
            border-radius: 20px; text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        #timerDisplay { font-size: 3.5rem; font-weight: 800; font-variant-numeric: tabular-nums; }

        .nav-scroller { display: flex; gap: 10px; padding: 15px; overflow-x: auto; scrollbar-width: none; }
        .nav-scroller::-webkit-scrollbar { display: none; }
        .pill {
            flex: none; padding: 10px 20px; border-radius: 25px;
            background: var(--card); color: var(--text-dim); font-weight: 700;
            border: 1px solid transparent; transition: 0.2s;
        }
        .pill.active { background: var(--blue); color: white; border-color: var(--blue); }

        .exercise-card {
            background: var(--card); margin: 0 15px 15px;
            border-radius: 20px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .ex-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .ex-name { font-size: 1.1rem; font-weight: 800; color: var(--blue); }

        .set-row {
            display: grid; grid-template-columns: 30px 1fr 1fr 1fr 40px;
            gap: 8px; align-items: center; margin-bottom: 8px;
        }

        .input-group {
            background: #0b1220; border: 1px solid #2d3748;
            border-radius: 10px; padding: 8px 4px; transition: 0.2s;
        }
        .input-group.filled { border-color: var(--green); background: rgba(72, 187, 120, 0.05); }

        input {
            background: transparent; border: none; color: white;
            width: 100%; text-align: center; font-size: 1rem; font-weight: 700;
        }

        .btn-check { background: none; border: none; color: var(--text-dim); font-size: 1.4rem; transition: 0.2s; cursor: pointer; }
        .btn-check.active { color: var(--green); transform: scale(1.1); }

        .dock {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(11, 18, 32, 0.95); backdrop-filter: blur(15px);
            display: grid; grid-template-columns: repeat(4, 1fr);
            padding: 10px 0 calc(15px + env(safe-area-inset-bottom));
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .dock-item { background: none; border: none; color: var(--text-dim); display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 0.7rem; font-weight: 700; }
        .dock-item.active { color: var(--blue); }

        .btn-main { width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; }

        dialog { background: var(--card); color: white; border: 1px solid #2d3748; border-radius: 20px; width: 90%; max-width: 450px; padding: 25px; border: 1px solid var(--blue); }
        dialog::backdrop { background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); }
        
        .lib-item { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .lib-item:active { background: var(--glass); }
    </style>
</head>
<body>

<header>
    <div class="logo">TITAN <span style="color:var(--blue)">PRO</span></div>
    <div id="volDisplay" style="color: var(--green); font-weight: 800; font-size: 0.85rem;">0 KG</div>
</header>

<div class="timer-box">
    <div id="timerDisplay">02:00</div>
    <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button id="timerBtn" class="btn-main" style="background: var(--green); color: #052c16; flex: 2;" onclick="toggleTimer()">INICIAR DESCANSO</button>
        <button class="btn-main" style="background: var(--card); color: var(--text-dim); flex: 1;" onclick="resetTimer()">ZERAR</button>
    </div>
</div>

<div class="nav-scroller" id="navTabs"></div>
<main id="workoutContainer"></main>

<div style="padding: 0 15px 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
    <button class="btn-main" style="background: var(--glass); color: var(--blue); border: 1px solid var(--blue);" onclick="openLibrary()">+ EXERCÍCIO</button>
    <button class="btn-main" style="background: var(--glass); color: var(--orange); border: 1px solid var(--orange);" onclick="addNewTab()">+ NOVO TREINO</button>
</div>

<div class="dock">
    <button class="dock-item active"><i class="fa-solid fa-dumbbell"></i>Treino</button>
    <button class="dock-item" onclick="exportData()"><i class="fa-solid fa-file-export"></i>Exportar</button>
    <button class="dock-item" style="background: var(--green); border-radius: 12px; color: #052c16; margin: 0 8px;" onclick="saveSession()"><i class="fa-solid fa-check"></i>SALVAR</button>
    <button class="dock-item" onclick="confirmReset()"><i class="fa-solid fa-rotate-left"></i>Reset</button>
</div>

<dialog id="libModal">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0">Biblioteca</h3>
        <i class="fa-solid fa-xmark" onclick="document.getElementById('libModal').close()" style="cursor:pointer; font-size:1.5rem"></i>
    </div>
    <div id="libContent" style="max-height: 400px; overflow-y: auto;"></div>
</dialog>

<script>
    // --- DATABASE ---
    const LIBRARY = {
        "Peito": ["Supino Inclinado", "Supino Reto Barra", "Crossover Polia", "Voador", "Flexão"],
        "Costas": ["Puxada Alta", "Remada Curvada", "Remada Unilateral", "Barra Fixa", "Pulldown"],
        "Pernas": ["Agachamento", "Leg Press 45", "Extensora", "Flexora", "Stiff", "Panturrilha"],
        "Ombros": ["Desenvolvimento", "Elevação Lateral", "Face Pull", "Militar"],
        "Braços": ["Rosca Direta", "Tríceps Corda", "Rosca Martelo", "Tríceps Testa", "Rosca Scott"]
    };

    // --- STATE ---
    let state = JSON.parse(localStorage.getItem("titan_pro_v1")) || {
        activeTabIndex: 0,
        treinos: [{ id: Date.now(), name: "TREINO A", exercises: [] }]
    };

    let timer = { time: 120, base: 120, running: false, id: null };

    // --- RENDER ENGINE ---
    function render() {
        renderTabs();
        renderExercises();
        updateVolume();
    }

    function renderTabs() {
        const container = document.getElementById("navTabs");
        container.innerHTML = state.treinos.map((t, i) => `
            <div class="pill ${state.activeTabIndex === i ? 'active' : ''}" 
                 onclick="switchTab(${i})" 
                 oncontextmenu="deleteTab(${i}); return false;">
                ${t.name}
            </div>
        `).join("");
    }

    function renderExercises() {
        const container = document.getElementById("workoutContainer");
        const currentTreino = state.treinos[state.activeTabIndex];
        
        if (!currentTreino || currentTreino.exercises.length === 0) {
            container.innerHTML = `<div style="text-align:center; padding:40px; color:var(--text-dim)">Clique em + EXERCÍCIO para começar.</div>`;
            return;
        }

        container.innerHTML = currentTreino.exercises.map((ex, exIdx) => `
            <div class="exercise-card">
                <div class="ex-header">
                    <span class="ex-name">${ex.name}</span>
                    <i class="fa-solid fa-trash-can" style="color:var(--red); cursor:pointer" onclick="removeExercise(${exIdx})"></i>
                </div>
                <div class="sets-container">
                    ${ex.sets.map((set, setIdx) => `
                        <div class="set-row">
                            <span style="font-size:0.7rem; color:var(--text-dim); text-align:center;">${setIdx + 1}</span>
                            <div class="input-group ${set.kg ? 'filled' : ''}">
                                <input type="number" placeholder="kg" value="${set.kg}" oninput="updateSetData(${exIdx}, ${setIdx}, 'kg', this.value)">
                            </div>
                            <div class="input-group ${set.reps ? 'filled' : ''}">
                                <input type="number" placeholder="reps" value="${set.reps}" oninput="updateSetData(${exIdx}, ${setIdx}, 'reps', this.value)">
                            </div>
                            <div class="input-group">
                                <input type="number" placeholder="RPE" value="${set.rpe || ''}" oninput="updateSetData(${exIdx}, ${setIdx}, 'rpe', this.value)">
                            </div>
                            <button class="btn-check ${set.done ? 'active' : ''}" onclick="toggleSetDone(${exIdx}, ${setIdx})">
                                <i class="fa-solid fa-circle-check"></i>
                            </button>
                        </div>
                    `).join("")}
                </div>
                <button onclick="addSet(${exIdx})" style="background:none; border:none; color:var(--blue); font-weight:800; font-size:0.75rem; margin-top:10px; cursor:pointer">+ ADICIONAR SÉRIE</button>
            </div>
        `).join("");
    }

    // --- LOGIC ---
    function switchTab(i) { state.activeTabIndex = i; render(); save(); }

    function updateSetData(exIdx, setIdx, field, val) {
        state.treinos[state.activeTabIndex].exercises[exIdx].sets[setIdx][field] = val;
        // Não renderizamos tudo aqui para não perder o foco do input
        save();
        updateVolume();
    }

    function toggleSetDone(exIdx, setIdx) {
        const set = state.treinos[state.activeTabIndex].exercises[exIdx].sets[setIdx];
        set.done = !set.done;
        if(set.done) startTimer();
        render();
        save();
    }

    function addSet(exIdx) {
        state.treinos[state.activeTabIndex].exercises[exIdx].sets.push({ kg: '', reps: '', rpe: '', done: false });
        render();
        save();
    }

    function removeExercise(exIdx) {
        if(confirm("Remover exercício?")) {
            state.treinos[state.activeTabIndex].exercises.splice(exIdx, 1);
            render();
            save();
        }
    }

    function addNewTab() {
        const name = prompt("Nome do Treino (ex: Treino B):");
        if(name) {
            state.treinos.push({ id: Date.now(), name: name.toUpperCase(), exercises: [] });
            state.activeTabIndex = state.treinos.length - 1;
            render();
            save();
        }
    }

    function deleteTab(i) {
        if(state.treinos.length > 1 && confirm("Excluir este treino inteiro?")) {
            state.treinos.splice(i, 1);
            state.activeTabIndex = 0;
            render();
            save();
        }
    }

    // --- LIBRARY ---
    function openLibrary() {
        const content = document.getElementById("libContent");
        content.innerHTML = "";
        for(let cat in LIBRARY) {
            content.innerHTML += `<div style="color:var(--blue); font-weight:800; margin:15px 0 5px; font-size:0.8rem">${cat.toUpperCase()}</div>`;
            LIBRARY[cat].forEach(ex => {
                content.innerHTML += `
                    <div class="lib-item" onclick="addFromLib('${ex}')">
                        ${ex} <i class="fa-solid fa-plus-circle" style="color:var(--green)"></i>
                    </div>
                `;
            });
        }
        document.getElementById("libModal").showModal();
    }

    function addFromLib(name) {
        state.treinos[state.activeTabIndex].exercises.push({
            name: name,
            sets: [{ kg: '', reps: '', rpe: '', done: false }, { kg: '', reps: '', rpe: '', done: false }, { kg: '', reps: '', rpe: '', done: false }]
        });
        document.getElementById("libModal").close();
        render();
        save();
    }

    // --- TIMER ---
    function startTimer() {
        clearInterval(timer.id);
        timer.time = timer.base;
        timer.running = true;
        updateTimerBtn();
        timer.id = setInterval(() => {
            if(timer.time > 0) {
                timer.time--;
                updateTimerUI();
            } else {
                clearInterval(timer.id);
                timer.running = false;
                updateTimerBtn();
                if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
            }
        }, 1000);
    }

    function toggleTimer() {
        if(timer.running) {
            clearInterval(timer.id);
            timer.running = false;
        } else {
            startTimer();
        }
        updateTimerBtn();
    }

    function resetTimer() {
        clearInterval(timer.id);
        timer.running = false;
        timer.time = timer.base;
        updateTimerUI();
        updateTimerBtn();
    }

    function updateTimerUI() {
        const m = Math.floor(timer.time / 60);
        const s = timer.time % 60;
        document.getElementById("timerDisplay").textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function updateTimerBtn() {
        const btn = document.getElementById("timerBtn");
        btn.textContent = timer.running ? "PAUSAR" : "INICIAR DESCANSO";
        btn.style.background = timer.running ? "var(--red)" : "var(--green)";
    }

    // --- DATA ---
    function updateVolume() {
        let total = 0;
        const current = state.treinos[state.activeTabIndex];
        if(current) {
            current.exercises.forEach(ex => {
                ex.sets.forEach(s => {
                    if(s.done) total += (parseFloat(s.kg) || 0) * (parseFloat(s.reps) || 0);
                });
            });
        }
        document.getElementById("volDisplay").textContent = `${total.toLocaleString()} KG`;
    }

    function save() { localStorage.setItem("titan_pro_v1", JSON.stringify(state)); }

    function saveSession() {
        if(confirm("Deseja finalizar o treino e limpar as marcas de conclusão?")) {
            // Aqui você salvaria no histórico oficial antes de limpar
            state.treinos[state.activeTabIndex].exercises.forEach(ex => {
                ex.sets.forEach(s => s.done = false);
            });
            render();
            save();
            alert("Treino salvo com sucesso!");
        }
    }

    function confirmReset() {
        if(confirm("Isso apagará todos os seus treinos e configurações. Confirmar?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "titan_pro_backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    // --- INIT ---
    render();
    updateTimerUI();
</script>
</body>
</html>
